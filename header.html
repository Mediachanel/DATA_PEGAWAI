<style>
  .topbar {
    display:flex; align-items:center; justify-content:space-between;
    padding:12px 16px; background:linear-gradient(120deg, rgba(94,139,255,0.14), rgba(255,159,104,0.16)), #ffffff;
    border-bottom:1px solid #e6ecf4;
    position: sticky; top:0; z-index:60; width:100%; box-shadow: 0 10px 28px rgba(24,39,75,0.12);
    backdrop-filter: blur(6px);
  }
  .toolbar { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; font-weight:700; font-size:12px; }
  .pill.role { background:#eef3ff; color:#3b5ecc; }
  .pill.ukpd { background:#e7f7ff; color:#0f5f82; }
  .brand-title { font-size:18px; font-weight:800; color:#1b2b3a; }
  .user { display:flex; align-items:center; gap:10px; padding:8px 10px; background:#f8fafc; border:1px solid #e6ecf4; border-radius:12px; box-shadow:0 8px 18px rgba(24,39,75,0.08); }
  .user img { width:40px; height:40px; border-radius:12px; object-fit:cover; }
  .user-name { font-weight:800; color:#1b2b3a; }
  .user-role { font-size:12px; color:#6b7280; }
  .danger-btn { background:linear-gradient(135deg, #ff6b6b, #ff9f68); color:#fff; border:none; border-radius:12px; padding:9px 14px; cursor:pointer; font-weight:800; box-shadow: 0 12px 26px rgba(255,107,107,0.28); }
</style>

<header class="topbar">
  <div class="toolbar">
    <div class="brand-title">Dashboard Dinas Kesehatan</div>
  </div>
  <div class="user">
    <img src="foto/Dinkes.png" alt="user" data-logo-header />
    <div>
      <div class="user-name" id="userName">User</div>
      <div class="user-role" id="userRole">-</div>
    </div>
    <button class="danger-btn" id="logoutBtn">Logout</button>
  </div>
</header>

<script>
  (()=> {
    const authUser = (()=>{ try { return JSON.parse(localStorage.getItem('authUser')||'null'); } catch { return null; } })();
    if (!authUser) return;
    const role = authUser.role || 'USER';
    const nama = authUser.namaUkpd || authUser.username || 'User';
    const rolePill = document.getElementById('rolePill');
    const ukpdPill = document.getElementById('ukpdPill');
    const userName = document.getElementById('userName');
    const userRole = document.getElementById('userRole');
    if (rolePill) rolePill.textContent = role.toUpperCase();
    if (ukpdPill) ukpdPill.textContent = nama;
    if (userName) userName.textContent = nama;
    if (userRole) userRole.textContent = role;

    // Idle auto-logout (15 menit)
    const BASE = (() => {
      const parts = location.pathname.split('/').filter(Boolean);
      return parts.length && parts[0].toUpperCase() === 'DATA_PEGAWAI' ? '/' + parts[0] + '/' : '/';
    })();
    const IDLE_MS = 15 * 60 * 1000;
    let idleTimer;
    function doLogoutIdle(){
      try{ localStorage.removeItem('authUser'); }catch(_){}
      window.location.href = BASE;
    }
    function resetIdle(){
      if (idleTimer) clearTimeout(idleTimer);
      idleTimer = setTimeout(doLogoutIdle, IDLE_MS);
    }
    ['click','keydown','mousemove','scroll','touchstart','focus'].forEach(ev=>{
      document.addEventListener(ev, resetIdle, { passive:true });
    });
    resetIdle();
  })();
</script>
